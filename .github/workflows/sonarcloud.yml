name: Pull Request 
on:
  pull_request:
    types: [assigned, opened, synchronize, reopened]
  push:
    branches: [ master ]

jobs:
  sonarcloud:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install NotifyBintray
        run:  dotnet nuget add source --name NotifyBintray https://api.bintray.com/nuget/gov-uk-notify/nuget 
      - name: Install dotnet-sonarscanner
        run:  dotnet tool install --global dotnet-sonarscanner --version 4.8.0
      - name: Install dependencies
        run:  sudo dotnet restore && sudo apt-get update && sudo apt-get install -y libsqlite3-mod-spatialite
      - name: SonarCloud
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          dotnet sonarscanner begin /k:"${{ secrets.SONAR_TOKEN }}" /o:"dfe-digital" /n:"get-into-teaching-api" /d:sonar.host.url="https://sonarcloud.io" /d:sonar.verbose=true 
          sudo dotnet build .
          dotnet sonarscanner end 